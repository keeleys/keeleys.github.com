<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="jooq使用分享"/>













  <link rel="alternate" href="/default" title="凉水">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1" />



<link rel="canonical" href="http://www.sitec.cc/2017/03/16/jooq-use/"/>



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css" />



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1" />



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>








<script>
  window.config = {"title":"凉水","subtitle":"凉水.","description":"程序员,java,互联网,学习","author":"keeleys","language":"zh-CN","timezone":null,"url":"http://www.sitec.cc","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":year-:month-:day-:title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":true,"tab_replace":null,"first_line_number":"always1"},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":10,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repo":"git@github.com:keeleys/keeleys.github.com.git"},"ignore":[],"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"duoshuo_shortname":"keeley","jiathis":false,"duoshuo_share":true,"social":{"email":"keeley.jun@email.com","stack-overflow":null,"twitter":null,"facebook":null,"linkedin":null,"google":null,"github":"https://github.com/keeleys","weibo":null,"zhihu":null,"douban":null,"pocket":null,"tumblr":null,"instagram":null},"creative_commons":"by-nc-sa","baidu_analytics":null,"since":2015,"avatar":"https://dn-keeley.qbox.me/artive.jpeg","archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"category_generator":{"per_page":10},"tag_generator":{"per_page":10},"index_generator":{"per_page":10,"order_by":"-date"},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true},"server":{"port":4000,"log":false,"ip":"0.0.0.0","compress":false,"header":true},"favicon":"/favicon.ico","rss":"default","menu":{"Home":"/","Tags":"/tags","Categories":"/categories","About":"/about"},"color":"default","mode":"archives","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":true,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">知识共享署名-非商业性使用 4.0 国际许可协议</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"leancloud":{"app_id":null,"app_key":null},"baidu_verification":null,"google_analytics":null,"google_verification":null,"disqus_shortname":"sitecc","changyan":{"appid":null,"appkey":null},"livere_datauid":null,"version":"2.10.1"};
</script>

    <title> jooq使用分享 - 凉水 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">凉水</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">凉水</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          jooq使用分享
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-03-16
        </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get操作"><span class="toc-text">get操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update"><span class="toc-text">update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete"><span class="toc-text">delete</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fetch"><span class="toc-text">fetch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目实际参考"><span class="toc-text">项目实际参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库分组查询"><span class="toc-text">数据库分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java8分组查询"><span class="toc-text">java8分组查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分页查询"><span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>maven 里面引入<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zxy.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common-dao<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>用spring注解进来<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> CommonDao&lt;Member&gt; dao ;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDao</span><span class="params">(CommonDao&lt;Member&gt; dao)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dao = dao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="get操作"><a href="#get操作" class="headerlink" title="get操作"></a>get操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dao.get(ID id);</span><br><span class="line">dao.getOptional(ID id);</span><br></pre></td></tr></table></figure>
<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">update</span><span class="params">(T entity)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Collection&lt;T&gt; entities)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// JOOQGenericDao源码  如果修改的实体有null值，但是数据库又是不能为null的，那么这个字段不会修改。</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">update</span><span class="params">(T entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.record(entity, <span class="keyword">true</span>, DSL.using(<span class="keyword">this</span>.configuration)).update();</span><br><span class="line">        <span class="keyword">return</span> entity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> UpdatableRecord&lt;?&gt; record(T object, <span class="keyword">boolean</span> forUpdate, DSLContext context) &#123;</span><br><span class="line">        UpdatableRecord r = (UpdatableRecord)context.newRecord(<span class="keyword">this</span>.table, object);</span><br><span class="line">        <span class="keyword">if</span>(forUpdate) &#123;</span><br><span class="line">            r.changed(<span class="keyword">this</span>.primaryKey, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> size = r.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(r.getValue(i) == <span class="keyword">null</span> &amp;&amp; !r.field(i).getDataType().nullable()) &#123;</span><br><span class="line">                r.changed(i, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public final int update()</span><br><span class="line">Description copied from interface: UpdatableRecord</span><br><span class="line">Store this record back to the database using an UPDATE statement.</span><br><span class="line">This is the same as UpdatableRecord.store(), except that an UPDATE statement (or no statement) will always be executed.</span><br><span class="line"></span><br><span class="line">If you want to enforce statement execution, regardless if the values in this record were changed, you can explicitly set the changed flags for all values with Record.changed(boolean) or for single values with Record.changed(Field, boolean), prior to updating.</span><br><span class="line"></span><br><span class="line">This is the same as calling record.update(record.fields())</span><br></pre></td></tr></table></figure>
<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delete(ID id)</span><br><span class="line">delete(Collection&lt;ID&gt; ids)</span><br><span class="line">delete(Condition... conditions)</span><br><span class="line">delete(Stream&lt;Condition&gt; conditions)</span><br><span class="line">deleteWithOptional(Stream&lt;Optional&lt;Condition&gt;&gt; conditions)</span><br></pre></td></tr></table></figure>
<p>根据ID返还唯一对象，get查询不到会报错，getOptional返还可为空的对象.</p>
<h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><ol>
<li><p>只查询一列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; titles1 = create.select().from(BOOK).fetch().getValues(BOOK.TITLE);</span><br><span class="line">List&lt;String&gt; titles2 = create.select().from(BOOK).fetch(BOOK.TITLE);</span><br><span class="line">String[]     titles3 = create.select().from(BOOK).fetchArray(BOOK.TITLE);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询一列并且类型转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Long&gt; ids1 = create.select().from(BOOK).fetch().getValues(BOOK.ID, Long.class);</span><br><span class="line">List&lt;Long&gt; ids2 = create.select().from(BOOK).fetch(BOOK.ID, Long.class);</span><br><span class="line">Long[]     ids3 = create.select().from(BOOK).fetchArray(BOOK.ID, Long.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询book的id,并且查询所有等于这个id的结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, BookRecord&gt; map1 = create.selectFrom(BOOK).fetch().intoMap(BOOK.ID);</span><br><span class="line">Map&lt;Integer, BookRecord&gt; map2 = create.selectFrom(BOOK).fetchMap(BOOK.ID);</span><br><span class="line">Map&lt;Integer, String&gt;     map3 = create.selectFrom(BOOK).fetch().intoMap(BOOK.ID, BOOK.TITLE);</span><br><span class="line">Map&lt;Integer, String&gt;     map4 = create.selectFrom(BOOK).fetchMap(BOOK.ID, BOOK.TITLE);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Group by AUTHOR_ID and list all books written by any author:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Result&lt;BookRecord&gt;&gt; group1 = create.selectFrom(BOOK).fetch().intoGroups(BOOK.AUTHOR_ID);</span><br><span class="line">Map&lt;Integer, Result&lt;BookRecord&gt;&gt; group2 = create.selectFrom(BOOK).fetchGroups(BOOK.AUTHOR_ID);</span><br><span class="line">Map&lt;Integer, List&lt;String&gt;&gt;       group3 = create.selectFrom(BOOK).fetch().intoGroups(BOOK.AUTHOR_ID, BOOK.TITLE);</span><br><span class="line">Map&lt;Integer, List&lt;String&gt;&gt;       group4 = create.selectFrom(BOOK).fetchGroups(BOOK.AUTHOR_ID, BOOK.TITLE);</span><br></pre></td></tr></table></figure>
</li>
<li><p>fetchInto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create.selectFrom(BOOK)</span><br><span class="line">      .orderBy(BOOK.ID)</span><br><span class="line">      .fetch()</span><br><span class="line">      .into(<span class="keyword">new</span> RecordHandler&lt;BookRecord&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">(BookRecord book)</span> </span>&#123;</span><br><span class="line">              Util.doThingsWithBook(book);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="comment">// Or more concisely</span></span><br><span class="line">create.selectFrom(BOOK)</span><br><span class="line">      .orderBy(BOOK.ID)</span><br><span class="line">      .fetchInto(<span class="keyword">new</span> RecordHandler&lt;BookRecord&gt;() &#123;...&#125;);</span><br><span class="line"><span class="comment">// Or even more concisely with Java 8's lambda expressions:</span></span><br><span class="line">create.selectFrom(BOOK)</span><br><span class="line">      .orderBy(BOOK.ID)</span><br><span class="line">      .fetchInto(book -&gt; &#123; Util.doThingsWithBook(book); &#125;; );</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="项目实际参考"><a href="#项目实际参考" class="headerlink" title="项目实际参考"></a>项目实际参考</h2><h3 id="数据库分组查询"><a href="#数据库分组查询" class="headerlink" title="数据库分组查询"></a>数据库分组查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = grantCommonDao.execute(x -&gt;</span><br><span class="line">                x.select(GRANT.OPERATOR_TYPES).from(GRANT)</span><br><span class="line">                        .leftJoin(GRANT_DETAIL).on(GRANT.ID.eq(GRANT_DETAIL.GRANT_ID))</span><br><span class="line">                        .leftJoin(ROLE).on(GRANT.ROLE_ID.eq(ROLE.ID))</span><br><span class="line">                        .leftJoin(parentRole).on(GRANT.ROLE_ID.eq(parentRole.PARENT_ID))</span><br><span class="line">                        .where(GRANT_DETAIL.MEMBER_ID.eq(memberId))</span><br><span class="line">                        .and(GRANT_DETAIL.ORGANIZATION_ID.in(organizationIds))</span><br><span class="line">                        .and(ROLE.ID.eq(roleId).or(parentRole.ID.eq(roleId)))</span><br><span class="line">                        .groupBy(GRANT.OPERATOR_TYPES))</span><br><span class="line">                .fetch().getValues(GRANT.OPERATOR_TYPES);</span><br></pre></td></tr></table></figure>
<h3 id="java8分组查询"><a href="#java8分组查询" class="headerlink" title="java8分组查询"></a>java8分组查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Result&lt;Record&gt; record = courseChapterCommonDao.execute(</span><br><span class="line">        x -&gt; x.select(Fields.start().add(COURSE_CHAPTER).add(COURSE_CHAPTER_SECTION).end()).from(COURSE_CHAPTER)</span><br><span class="line">                .leftJoin(COURSE_CHAPTER_SECTION).on(COURSE_CHAPTER.ID.eq(COURSE_CHAPTER_SECTION.CHAPTER_ID))</span><br><span class="line">                .where(COURSE_CHAPTER.COURSE_ID.eq(courseId))</span><br><span class="line">                .orderBy(COURSE_CHAPTER.SEQUENCE.desc(), COURSE_CHAPTER_SECTION.SEQUENCE.asc())</span><br><span class="line">                .fetch());</span><br><span class="line"></span><br><span class="line">Map&lt;String, List&lt;CourseChapterSection&gt;&gt; sectionMap = record.into(COURSE_CHAPTER_SECTION)</span><br><span class="line">        .into(CourseChapterSection.class).stream().filter(x -&gt; x.getId() != <span class="keyword">null</span>)</span><br><span class="line">        .collect(groupingBy(CourseChapterSection::getChapterId));</span><br><span class="line"></span><br><span class="line">List&lt;CourseChapter&gt; courseChapters =  <span class="keyword">new</span> ArrayList&lt;&gt;(record.into(COURSE_CHAPTER).into(CourseChapter.class).stream()</span><br><span class="line">        .collect(toMap(CourseChapter::getId, p -&gt; p, (p, q) -&gt; q)).values());</span><br><span class="line"></span><br><span class="line">courseChapters.forEach(x -&gt; x.setCourseChapterSections(sectionMap.get(x.getId())));</span><br><span class="line"></span><br><span class="line">courseChapters.sort((a, b) -&gt; a.getSequence() - b.getSequence()); <span class="comment">// 倒序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> courseChapters;</span><br></pre></td></tr></table></figure>
<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">com.zxy.product.course.jooq.tables.Organization organizationTable = ORGANIZATION.as(<span class="string">"organization"</span>); <span class="comment">// 所属部门</span></span><br><span class="line">com.zxy.product.course.jooq.tables.Member createUserTable = MEMBER.as(<span class="string">"createUser"</span>); <span class="comment">// 创建人</span></span><br><span class="line"></span><br><span class="line">SelectSelectStep&lt;Record&gt; selectListField = x</span><br><span class="line">        .select(Fields.start().add(COURSE_INFO).add(organizationTable).add(createUserTable).end()); <span class="comment">// 查询list</span></span><br><span class="line">SelectSelectStep&lt;Record&gt; selectCountField = x.select(Fields.start().add(COURSE_INFO.ID.count()).end()); <span class="comment">// 查询总条数</span></span><br><span class="line"></span><br><span class="line">List&lt;Condition&gt; param = Stream</span><br><span class="line">        .of(name.map(COURSE_INFO.NAME::contains), status.map(COURSE_INFO.STATUS::eq),</span><br><span class="line">                createTime.map(COURSE_INFO.CREATE_TIME::gt),</span><br><span class="line">                organizationId.map(COURSE_INFO.ORGANIZATION_ID::eq), type.map(COURSE_INFO.TYPE::eq))</span><br><span class="line">        .filter(Optional::isPresent).map(Optional::get).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">Function&lt;SelectSelectStep&lt;Record&gt;, SelectConditionStep&lt;Record&gt;&gt; stepFunc = a -&gt; &#123;</span><br><span class="line">    SelectConditionStep&lt;Record&gt; select = a.from(COURSE_INFO).leftJoin(organizationTable)</span><br><span class="line">            .on(organizationTable.ID.eq(COURSE_INFO.ORGANIZATION_ID)).leftJoin(createUserTable)</span><br><span class="line">            .on(createUserTable.ID.eq(COURSE_INFO.CREATE_MEMBER_ID)).where(param);</span><br><span class="line"></span><br><span class="line">    itemScromType.map(stype -&gt; select.andExists(x.select(COURSE_CHAPTER_SECTION.ID)</span><br><span class="line">            .from(COURSE_CHAPTER_SECTION).where(COURSE_INFO.ID.eq(COURSE_CHAPTER_SECTION.COURSE_ID)</span><br><span class="line">                    .and(COURSE_CHAPTER_SECTION.FILE_TYPE.eq(stype)))));</span><br><span class="line">    <span class="keyword">return</span> select;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count = stepFunc.apply(selectCountField).fetchOne().getValue(<span class="number">0</span>, Integer.class);</span><br><span class="line"></span><br><span class="line">SelectConditionStep&lt;Record&gt; listSetp = stepFunc.apply(selectListField);</span><br><span class="line">listSetp.orderBy(COURSE_INFO.CREATE_TIME.desc());</span><br><span class="line">Result&lt;Record&gt; record = listSetp.limit((pageNum - <span class="number">1</span>) * pageSize, pageSize).fetch();</span><br><span class="line"></span><br><span class="line">List&lt;CourseInfo&gt; courseInfoList = record.into(COURSE_INFO).into(CourseInfo.class);</span><br><span class="line">List&lt;Organization&gt; organizationList = record.into(organizationTable).into(Organization.class);</span><br><span class="line">List&lt;Member&gt; createUserList = record.into(createUserTable).into(Member.class);</span><br><span class="line"></span><br><span class="line">IntStream.range(<span class="number">0</span>, courseInfoList.size()).forEach(i -&gt; &#123;</span><br><span class="line">    courseInfoList.get(i).setOrganization(organizationList.get(i));</span><br><span class="line">    courseInfoList.get(i).setCreateUser(createUserList.get(i));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> PagedResult.create(count, courseInfoList);</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.jooq.org/doc/3.8/manual/" target="_blank" rel="noopener">官方文档</a></li>
<li><a href="https://github.com/jOOQ/jOOQ/tree/master/jOOQ-examples/jOOQ-spring-example" target="_blank" rel="noopener">与spring结合</a></li>
</ul>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="http://www.sitec.cc">keeleys</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="http://www.sitec.cc/2017/03/16/jooq-use/">http://www.sitec.cc/2017/03/16/jooq-use/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/07/24/mysql-procedure/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">MySQL存储过程笔记</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2017/02/10/proxychains/">
        <span class="next-text nav-default">shadowsocks终端翻墙</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:keeley.jun@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/keeleys" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">keeleys</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://www.sitec.cc/2017/03/16/jooq-use/';
        this.page.identifier = '2017/03/16/jooq-use/';
        this.page.title = 'jooq使用分享';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//sitecc.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
